{% extends "base.html" %}
{% block title %}Being Hunted | Venator{% endblock %}
{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
  body { background: linear-gradient(120deg, #f3f8fd 60%, #e0e7ff 100%); }
  .scheduled-card {
    background: #fff;
    border-radius: 24px;
    box-shadow: 0 4px 24px rgba(35,85,216,0.13);
    padding: 2.7rem 2.2rem;
    margin-top: 2.5rem;
    border: 2.5px solid #2355d8;
  }
  .venator-heading {
    font-family: 'Pacifico', cursive;
    font-size: 2.5rem;
    color: #2355d8;
    letter-spacing: 2px;
    margin-bottom: 0.5rem;
    text-align: center;
  }
  .venator-table {
    border-collapse: separate;
    border-spacing: 0 1rem;
    width: 100%;
  }
  .venator-table th, .venator-table td {
    background: #fff;
    border: 1.5px solid #e0e7ef;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    padding: 1rem 1.2rem;
    vertical-align: middle;
  }
  .venator-table th {
    background: linear-gradient(90deg, #e0e7ff 60%, #f3f8fd 100%);
    font-weight: 700;
    font-size: 1.13rem;
    border-bottom: 2.5px solid #b6c6e3;
    color: #2355d8;
    letter-spacing: 0.5px;
  }
  .venator-table tr {
    border-radius: 12px;
  }
  .venator-table a { color: #2355d8; font-weight: 500; }
  .venator-table tbody tr:hover {
    background: #e9f5ff;
    box-shadow: 0 2px 12px rgba(35,85,216,0.09);
    transition: background 0.2s, box-shadow 0.2s;
  }
</style>
{% endblock %}
{% block content %}
<div class="row justify-content-center align-items-center" style="min-height:60vh;">
  <div class="col-lg-10">
    <div class="scheduled-card">
      <div class="venator-heading">Being Hunted</div>
      {% if scheduled_products %}
      <div class="table-responsive">
        <table class="venator-table">
          <thead>
            <tr>
              <th>Product URL</th>
              <th>Target Price</th>
              <th>Telegram Chat ID(s)</th>
              <th>Frequency (hours)</th>
              <th>Start Time</th>
              <th style="text-align:center; min-width:70px;">Edit</th>
              <th style="text-align:center; min-width:80px;">Delete</th>
            </tr>
          </thead>
          <tbody>
          {% for item in scheduled_products %}
            {% if edit_idx is defined and edit_idx == loop.index0 %}
            <form method="post" style="margin:0;">
              <tr style="background:#f3f8fd;">
                <td style="word-break:break-all;"><a href="{{ item.product_url }}" target="_blank">{{ item.product_url }}</a></td>
                <td><input type="number" class="form-control" name="edit_target_price" value="{{ item.target_price }}" required></td>
                <td><input type="text" class="form-control" name="edit_chat_ids" value="{{ item.telegram_chat_ids|join(', ') }}" required></td>
                <td>
                  <select class="form-select" name="edit_schedule_interval">
                    {% for h in [1,2,4,6,8,12,18,24] %}
                    <option value="{{h}}" {% if item.schedule_interval == h %}selected{% endif %}>{{h}}</option>
                    {% endfor %}
                  </select>
                </td>
                <td><input type="time" class="form-control" name="edit_start_time" value="{{ item.start_time or '00:00' }}"></td>
                <td style="text-align:center;">
                  <button type="submit" class="btn btn-primary btn-sm px-3" name="save_idx" value="{{ loop.index0 }}">Save</button>
                  <button type="submit" class="btn btn-secondary btn-sm px-3 ms-1" name="cancel_edit" value="1">Cancel</button>
                </td>
                <td></td>
              </tr>
            </form>
            {% else %}
            <tr>
              <td style="word-break:break-all;"><a href="{{ item.product_url }}" target="_blank">{{ item.product_url }}</a></td>
              <td>{{ item.target_price }}</td>
              <td>
                {% if item.telegram_chat_ids %}
                  {{ item.telegram_chat_ids|join(', ') }}
                {% elif item.telegram_chat_id %}
                  {{ item.telegram_chat_id }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>{{ item.schedule_interval }}</td>
              <td>{% if item.start_time %}{{ item.start_time }}{% else %}-{% endif %}</td>
              <td style="text-align:center;">
                <form method="post" style="margin:0;display:inline;">
                  <input type="hidden" name="edit_idx" value="{{ loop.index0 }}">
                  <button type="submit" class="btn btn-primary btn-sm px-3">Edit</button>
                </form>
              </td>
              <td style="text-align:center;">
                <form method="post" style="margin:0;display:inline;">
                  <input type="hidden" name="delete_idx" value="{{ loop.index0 }}">
                  <button type="submit" class="btn btn-danger btn-sm px-3" onclick="return confirm('Delete this scheduled product?');">Delete</button>
                </form>
              </td>
            </tr>
            {% endif %}
          {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="text-center">No products scheduled.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
