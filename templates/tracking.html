{% extends "base.html" %}
{% block title %}Being Hunted | Venator{% endblock %}
{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
  .scheduled-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 25px;
    box-shadow: 0 8px 32px rgba(26, 35, 126, 0.15);
    padding: 3rem 2.5rem;
    margin-top: 2rem;
    border: 1px solid rgba(26, 35, 126, 0.1);
    position: relative;
    overflow: hidden;
  }
  
  .scheduled-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, #1a237e, #3949ab, #5e35b1);
  }
  
  .venator-heading {
    font-family: 'Pacifico', cursive;
    font-size: 2.8rem;
    background: linear-gradient(135deg, #1a237e 0%, #3949ab 50%, #5e35b1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: 2px;
    margin-bottom: 1rem;
    text-align: center;
    position: relative;
  }
  
  .venator-heading::after {
    content: 'ðŸŽ¯';
    position: absolute;
    right: -40px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 2rem;
  }
  
  .venator-table {
    border-collapse: separate;
    border-spacing: 0 0.8rem;
    width: 100%;
    margin-top: 1.5rem;
  }
  
  .venator-table th {
    background: linear-gradient(135deg, #1a237e, #3949ab);
    color: white;
    border: none;
    padding: 1rem 1.2rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.9rem;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  .venator-table th:first-child {
    border-radius: 12px 0 0 12px;
  }
  
  .venator-table th:last-child {
    border-radius: 0 12px 12px 0;
  }
  
  .venator-table td {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(26, 35, 126, 0.1);
    padding: 1rem 1.2rem;
    transition: all 0.3s ease;
    position: relative;
    vertical-align: middle;
  }
  
  .venator-table td:first-child {
    border-radius: 12px 0 0 12px;
  }
  
  .venator-table td:last-child {
    border-radius: 0 12px 12px 0;
  }
  
  .venator-table tr:hover td {
    background: rgba(26, 35, 126, 0.05);
    box-shadow: 0 4px 15px rgba(26, 35, 126, 0.1);
  }
  
  .venator-table a { 
    color: var(--venator-secondary); 
    font-weight: 600; 
    text-decoration: none;
    transition: color 0.3s ease;
  }
  
  .venator-table a:hover {
    color: var(--venator-accent);
    text-decoration: underline;
  }
  
  .btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    border-radius: 20px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
  }
  
  .btn-warning {
    background: linear-gradient(135deg, #ff9800, #f57c00);
    border: none;
    color: white;
  }
  
  .btn-warning:hover {
    background: linear-gradient(135deg, #f57c00, #e65100);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
  }
  
  .btn-danger {
    background: linear-gradient(135deg, #f44336, #d32f2f);
    border: none;
    color: white;
  }
  
  .btn-danger:hover {
    background: linear-gradient(135deg, #d32f2f, #b71c1c);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
  }
  
  .btn-success {
    background: linear-gradient(135deg, #4caf50, #388e3c);
    border: none;
    color: white;
  }
  
  .btn-success:hover {
    background: linear-gradient(135deg, #388e3c, #2e7d32);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
  }
  
  .form-control, .form-select {
    border: 1px solid rgba(26, 35, 126, 0.2);
    border-radius: 8px;
    padding: 0.5rem;
    font-size: 0.9rem;
    transition: border-color 0.3s ease;
  }
  
  .form-control:focus, .form-select:focus {
    border-color: var(--venator-secondary);
    box-shadow: 0 0 0 0.2rem rgba(57, 73, 171, 0.25);
  }
  
  .no-products-msg {
    text-align: center;
    padding: 3rem 2rem;
    color: #666;
    font-size: 1.1rem;
    background: rgba(26, 35, 126, 0.05);
    border-radius: 15px;
    border: 2px dashed rgba(26, 35, 126, 0.2);
  }
  
  .no-products-msg i {
    font-size: 3rem;
    color: var(--venator-secondary);
    margin-bottom: 1rem;
    display: block;
  }
</style>
{% endblock %}
{% block content %}
<div class="row justify-content-center align-items-center" style="min-height:60vh;">
  <div class="col-lg-10">
    <div class="scheduled-card">
      <div class="venator-heading">Being Hunted</div>
      {% if scheduled_products %}
      <div class="table-responsive">
        <table class="venator-table">
          <thead>
            <tr>
              <th>Product URL</th>
              <th>Target Price</th>
              <th>Telegram Recipient(s)</th>
              <th>Frequency (hours)</th>
              <th>Start Time</th>
              <th style="text-align:center; min-width:70px;">Edit</th>
              <th style="text-align:center; min-width:80px;">Delete</th>
            </tr>
          </thead>
          <tbody>
          {% for item in scheduled_products %}
            {% if edit_idx is defined and edit_idx == loop.index0 %}
            <form method="post" style="margin:0;">
              <tr style="background:#f3f8fd;">
                <td style="word-break:break-all;"><a href="{{ item.product_url }}" target="_blank">{{ item.product_url }}</a></td>
                <td><input type="number" class="form-control" name="edit_target_price" value="{{ item.target_price }}" required></td>
                <td>
                  <input type="text" class="form-control" name="edit_chat_aliases" value="{% for cid in item.telegram_chat_ids %}{{ config.ID_TO_ALIAS[cid] if cid in config.ID_TO_ALIAS else cid }}{% if not loop.last %}, {% endif %}{% endfor %}" required placeholder="Enter aliases, comma separated">
                  <div class="form-text">Enter one or more nicknames (aliases), comma separated.</div>
                </td>
                <td>
                  <select class="form-select" name="edit_schedule_interval">
                    {% for h in [1,2,4,6,8,12,18,24] %}
                    <option value="{{h}}" {% if item.schedule_interval == h %}selected{% endif %}>{{h}}</option>
                    {% endfor %}
                  </select>
                </td>
                <td><input type="time" class="form-control" name="edit_start_time" value="{{ item.start_time or '00:00' }}"></td>
                <td style="text-align:center;">
                  <button type="submit" class="btn btn-primary btn-sm px-3" name="save_idx" value="{{ loop.index0 }}">Save</button>
                  <button type="submit" class="btn btn-secondary btn-sm px-3 ms-1" name="cancel_edit" value="1">Cancel</button>
                </td>
                <td></td>
              </tr>
            </form>
            {% else %}
            <tr>
              <td style="word-break:break-all;"><a href="{{ item.product_url }}" target="_blank">{{ item.product_url }}</a></td>
              <td>{{ item.target_price }}</td>
              <td>
                {% if item.telegram_chat_ids %}
                  {% for cid in item.telegram_chat_ids %}
                    {{ config.ID_TO_ALIAS[cid] if cid in config.ID_TO_ALIAS else cid }}{% if not loop.last %}, {% endif %}
                  {% endfor %}
                {% elif item.telegram_chat_id %}
                  {{ config.ID_TO_ALIAS[item.telegram_chat_id] if item.telegram_chat_id in config.ID_TO_ALIAS else item.telegram_chat_id }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>{{ item.schedule_interval }}</td>
              <td>{% if item.start_time %}{{ item.start_time }}{% else %}-{% endif %}</td>
              <td style="text-align:center;">
                <form method="post" style="margin:0;display:inline;">
                  <input type="hidden" name="edit_idx" value="{{ loop.index0 }}">
                  <button type="submit" class="btn btn-primary btn-sm px-3">Edit</button>
                </form>
              </td>
              <td style="text-align:center;">
                <form method="post" style="margin:0;display:inline;">
                  <input type="hidden" name="delete_idx" value="{{ loop.index0 }}">
                  <button type="submit" class="btn btn-danger btn-sm px-3" onclick="return confirm('Delete this scheduled product?');">Delete</button>
                </form>
              </td>
            </tr>
            {% endif %}
          {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="text-center">No products scheduled.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
