{% extends "base.html" %}
{% block title %}Hunt | Venator{% endblock %}
{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
  .tracker-card {
    box-shadow: 0 8px 32px rgba(26, 35, 126, 0.15);
    border-radius: 25px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 3rem 2.5rem;
    margin-top: 2rem;
    border: 1px solid rgba(26, 35, 126, 0.1);
    position: relative;
    overflow: hidden;
  }
  
  .tracker-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, #1a237e, #3949ab, #5e35b1);
  }
  
  .form-label { 
    font-weight: 600; 
    color: var(--venator-primary);
    margin-bottom: 0.7rem;
  }
  
  .form-control, .form-select {
    border: 2px solid rgba(26, 35, 126, 0.1);
    border-radius: 12px;
    padding: 0.8rem 1rem;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.9);
  }
  
  .form-control:focus, .form-select:focus {
    border-color: var(--venator-secondary);
    box-shadow: 0 0 0 0.2rem rgba(57, 73, 171, 0.25);
    background: white;
  }
  
  .btn-primary {
    background: linear-gradient(135deg, #1a237e 0%, #3949ab 50%, #5e35b1 100%);
    border: none;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 1rem 2.5rem;
    border-radius: 25px;
    box-shadow: 0 4px 15px rgba(26, 35, 126, 0.3);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .btn-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #3949ab 0%, #5e35b1 50%, #7e57c2 100%);
    transition: left 0.3s ease;
    z-index: -1;
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(26, 35, 126, 0.4);
  }
  
  .btn-primary:hover::before {
    left: 0;
  }
  
  .venator-heading {
    font-family: 'Pacifico', cursive;
    font-size: 2.8rem;
    background: linear-gradient(135deg, #1a237e 0%, #3949ab 50%, #5e35b1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: 2px;
    margin-bottom: 1rem;
    text-align: center;
    position: relative;
  }
  
  .venator-heading::after {
    content: 'ðŸŽ¯';
    position: absolute;
    right: -40px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 2rem;
    animation: target 3s infinite;
  }
  
  @keyframes target {
    0%, 100% { transform: translateY(-50%) scale(1); }
    50% { transform: translateY(-50%) scale(1.1); }
  }
  
  .flash { 
    margin-top: 1.5rem; 
    border-radius: 12px;
    border: none;
    font-weight: 500;
  }
  
  .alert-success {
    background: linear-gradient(135deg, rgba(46, 125, 50, 0.1), rgba(76, 175, 80, 0.1));
    color: #2e7d32;
    border-left: 4px solid #4caf50;
  }
  
  .info-card {
    background: linear-gradient(135deg, rgba(26, 35, 126, 0.05), rgba(94, 53, 177, 0.05));
    border-radius: 18px;
    padding: 1.5rem;
    margin-top: 2rem;
    border: 1px solid rgba(26, 35, 126, 0.1);
    position: relative;
  }
  
  .info-card::before {
    content: 'ðŸ’¡';
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 1.5rem;
  }
  
  .schedule-row { 
    gap: 1rem; 
    margin-top: 1.5rem;
  }
  
  .form-check-input:checked {
    background-color: var(--venator-secondary);
    border-color: var(--venator-secondary);
  }
  
  .form-check-label { 
    margin-left: 0.7rem; 
    font-weight: 500;
    color: var(--venator-primary);
  }
  
  .link-btn { 
    text-decoration: none; 
    color: var(--venator-secondary); 
    font-weight: 600;
    transition: color 0.3s ease;
  }
  
  .link-btn:hover { 
    color: var(--venator-accent);
    text-decoration: underline; 
  }
  
  .input-group-text {
    background: var(--venator-light);
    border: 2px solid rgba(26, 35, 126, 0.1);
    color: var(--venator-primary);
    font-weight: 600;
  }
</style>
{% endblock %}
{% block content %}
<div class="row justify-content-center align-items-center" style="min-height:60vh;">
  <div class="col-lg-7">
    <div class="tracker-card p-4 shadow-lg">
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% for msg in messages %}
            <div class="alert alert-success flash" role="alert">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      {% if target_price or coupon_info %}
        <div class="mb-3">
          {% if target_price %}
            <div class="alert alert-info flash mb-2">Target Price: <b>{{ target_price }}</b></div>
          {% endif %}
          {% if coupon_info %}
            <div class="info-card">
              <b>Coupon Info:</b><br>
              {% if coupon_info.best_price %}<span style="color:#2355d8;">Best Price:</span> <b>{{ coupon_info.best_price }}</b><br>{% endif %}
              {% if coupon_info.applicable_on %}<span style="color:#2355d8;">Applicable On:</span> {{ coupon_info.applicable_on }}<br>{% endif %}
              {% if coupon_info.coupon_code %}<span style="color:#2355d8;">Coupon Code:</span> <b>{{ coupon_info.coupon_code }}</b><br>{% endif %}
              {% if coupon_info.coupon_discount %}<span style="color:#2355d8;">Coupon Discount:</span> {{ coupon_info.coupon_discount }}<br>{% endif %}
            </div>
          {% endif %}
        </div>
      {% endif %}
      <div class="venator-heading">Start Your Shopping Hunt</div>
      <form method="post">
        <div class="mb-3">
          <label for="product_url" class="form-label">
            Product URL
            <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="Paste the full URL of the product you want to track from Amazon, Myntra, etc.">
              <i class="bi bi-info-circle-fill text-info"></i>
            </span>
          </label>
          <input type="url" class="form-control" name="product_url" id="product_url" required>
        </div>
        <div class="mb-3">
          <label for="target_price" class="form-label">
            Target Price
            <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="Set the price at which you want to be notified. You'll get alerts when the product drops to or below this price.">
              <i class="bi bi-info-circle-fill text-info"></i>
            </span>
          </label>
          <input type="number" class="form-control" name="target_price" id="target_price" required>
        </div>
        <div class="mb-3">
          <label class="form-label">
            Telegram Recipients
            <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="Select or enter Telegram nicknames and chat IDs to receive notifications. Click for help on how to get your Chat ID." onclick="toggleChatIdHelp();">
              <i class="bi bi-info-circle-fill text-info" style="cursor:pointer;"></i>
            </span>
          </label>
          <select class="form-select" name="chatid_pick" id="chatid_pick" multiple size="3">
            {% for alias, chat_id in config.ALIAS_TO_ID.items() %}
              <option value="{{ chat_id }}">{{ alias }}</option>
            {% endfor %}
          </select>
          <div class="row mt-2 g-2">
            <div class="col-6">
              <input type="text" class="form-control" name="new_alias" id="new_alias" placeholder="New Nickname (optional)">
            </div>
            <div class="col-6">
              <input type="text" class="form-control" name="new_chatid" id="new_chatid" placeholder="New Chat ID (optional)">
            </div>
          </div>
          <div class="form-text">Select from the list and/or add a new nickname and chat ID.</div>
          <div id="chatid-help" class="alert alert-info mt-2 d-none" style="font-size:0.97em;">
            <button type="button" class="btn-close float-end" aria-label="Close" onclick="document.getElementById('chatid-help').classList.add('d-none');"></button>
            <b>How to get your Telegram Chat ID:</b><br>
            1. Open Telegram and search for <b>@myn_price_track_bot</b>.<br>
            2. Start a chat with the bot and send any message.<br>
            3. The bot will reply with your Chat ID.<br>
            4. Use this Chat ID here to receive notifications.<br>
            <br>
            <b>Tip:</b> You can also add group Chat IDs. Add the bot to your group, send a message, and the bot will reply with the group Chat ID.
          </div>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" name="schedule_tracking" id="schedule_tracking" onchange="document.getElementById('schedule_time_row').style.display = this.checked ? 'flex' : 'none';">
          <label class="form-check-label" for="schedule_tracking">
            Schedule this product for automatic tracking
            <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="Enable this to check the product price automatically at set intervals.">
              <i class="bi bi-info-circle-fill text-info"></i>
            </span>
          </label>
        </div>
        <div class="row schedule-row mb-3" id="schedule_time_row" style="display:none;">
          <div class="col-6">
            <label for="schedule_interval" class="form-label">
              Frequency
              <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="How often (in hours) the product price should be checked automatically.">
                <i class="bi bi-info-circle-fill text-info"></i>
              </span>
            </label>
            <select class="form-select" name="schedule_interval" id="schedule_interval">
              <option value="1">Every 1 hour</option>
              <option value="2">Every 2 hours</option>
              <option value="4" selected>Every 4 hours</option>
              <option value="6">Every 6 hours</option>
              <option value="8">Every 8 hours</option>
              <option value="12">Every 12 hours</option>
              <option value="18">Every 18 hours</option>
              <option value="24">Every 24 hours</option>
            </select>
          </div>
          <div class="col-6">
            <label for="start_time" class="form-label">
              Start time (24h)
              <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="The time of day when the first scheduled check should start (in 24-hour format).">
                <i class="bi bi-info-circle-fill text-info"></i>
              </span>
            </label>
            <input type="time" class="form-control" name="start_time" id="start_time" value="00:00">
          </div>
        </div>
        <div class="d-grid">
          <button type="submit" class="btn btn-primary btn-lg">Track Product</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
  // Enable Bootstrap tooltips
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
  function toggleChatIdHelp() {
    const helpDiv = document.getElementById('chatid-help');
    helpDiv.classList.toggle('d-none');
  }
</script>
{% endblock %}
