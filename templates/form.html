{% extends "base.html" %}
{% block title %}Hunt | Venator{% endblock %}
{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
  body { background: linear-gradient(120deg, #f3f8fd 60%, #e0e7ff 100%); }
  .tracker-card {
    box-shadow: 0 4px 24px rgba(35,85,216,0.13);
    border-radius: 22px;
    background: #fff;
    padding: 2.5rem 2.2rem;
    margin-top: 2.2rem;
    border: 2.5px solid #2355d8;
  }
  .form-label { font-weight: 500; }
  .btn-primary {
    background: linear-gradient(90deg, #4f8cff 0%, #2355d8 100%);
    border: none;
    font-weight: 600;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 8px rgba(35,85,216,0.08);
    transition: box-shadow 0.2s;
  }
  .btn-primary:hover {
    background: linear-gradient(90deg, #2355d8 0%, #4f8cff 100%);
    box-shadow: 0 4px 16px rgba(35,85,216,0.13);
  }
  .venator-heading {
    font-family: 'Pacifico', cursive;
    font-size: 2.5rem;
    color: #2355d8;
    letter-spacing: 2px;
    margin-bottom: 0.5rem;
    text-align: center;
  }
  .flash { margin-top: 1rem; }
  .info-card {
    background: #e9f5ff;
    border-radius: 14px;
    padding: 1.2rem;
    margin-top: 1.5rem;
    border: 1px solid #b6e0fe;
  }
  .schedule-row { gap: 1rem; }
  .form-check-label { margin-left: 0.5rem; }
  .link-btn { text-decoration: none; color: #2355d8; font-weight: 500; }
  .link-btn:hover { text-decoration: underline; }
</style>
{% endblock %}
{% block content %}
<div class="row justify-content-center align-items-center" style="min-height:60vh;">
  <div class="col-lg-7">
    <div class="tracker-card p-4 shadow-lg">
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% for msg in messages %}
            <div class="alert alert-success flash" role="alert">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      {% if target_price or coupon_info %}
        <div class="mb-3">
          {% if target_price %}
            <div class="alert alert-info flash mb-2">Target Price: <b>{{ target_price }}</b></div>
          {% endif %}
          {% if coupon_info %}
            <div class="info-card">
              <b>Coupon Info:</b><br>
              {% if coupon_info.best_price %}<span style="color:#2355d8;">Best Price:</span> <b>{{ coupon_info.best_price }}</b><br>{% endif %}
              {% if coupon_info.applicable_on %}<span style="color:#2355d8;">Applicable On:</span> {{ coupon_info.applicable_on }}<br>{% endif %}
              {% if coupon_info.coupon_code %}<span style="color:#2355d8;">Coupon Code:</span> <b>{{ coupon_info.coupon_code }}</b><br>{% endif %}
              {% if coupon_info.coupon_discount %}<span style="color:#2355d8;">Coupon Discount:</span> {{ coupon_info.coupon_discount }}<br>{% endif %}
            </div>
          {% endif %}
        </div>
      {% endif %}
      <div class="venator-heading">Start Your Shopping Hunt</div>
      <form method="post">
        <div class="mb-3">
          <label for="product_url" class="form-label">
            Product URL
            <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="Paste the full URL of the product you want to track from Amazon, Myntra, etc.">
              <i class="bi bi-info-circle-fill text-info"></i>
            </span>
          </label>
          <input type="url" class="form-control" name="product_url" id="product_url" required>
        </div>
        <div class="mb-3">
          <label for="target_price" class="form-label">
            Target Price
            <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="Set the price at which you want to be notified. You'll get alerts when the product drops to or below this price.">
              <i class="bi bi-info-circle-fill text-info"></i>
            </span>
          </label>
          <input type="number" class="form-control" name="target_price" id="target_price" required>
        </div>
        <div class="mb-3">
          <label class="form-label">
            Telegram Chat IDs
            <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="Select or enter Telegram Chat IDs to receive notifications. Click for help on how to get your Chat ID." onclick="toggleChatIdHelp();">
              <i class="bi bi-info-circle-fill text-info" style="cursor:pointer;"></i>
            </span>
          </label>
          <select class="form-select" name="chatid_pick" id="chatid_pick" multiple size="3">
            <option value="249722033">kalyan</option>
            <option value="258922383">uma</option>
          </select>
          <input type="text" class="form-control mt-2" name="custom_chatids" id="custom_chatids" placeholder="Enter additional Chat IDs, comma separated">
          <div class="form-text">Select from the list and/or enter additional chat IDs separated by commas.</div>
          <div id="chatid-help" class="alert alert-info mt-2 d-none" style="font-size:0.97em;">
            <button type="button" class="btn-close float-end" aria-label="Close" onclick="document.getElementById('chatid-help').classList.add('d-none');"></button>
            <b>How to get your Telegram Chat ID:</b><br>
            1. Open Telegram and search for <b>@myn_price_track_bot</b>.<br>
            2. Start a chat with the bot and send any message.<br>
            3. The bot will reply with your Chat ID.<br>
            4. Use this Chat ID here to receive notifications.<br>
            <br>
            <b>Tip:</b> You can also add group Chat IDs. Add the bot to your group, send a message, and the bot will reply with the group Chat ID.
          </div>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" name="schedule_tracking" id="schedule_tracking" onchange="document.getElementById('schedule_time_row').style.display = this.checked ? 'flex' : 'none';">
          <label class="form-check-label" for="schedule_tracking">
            Schedule this product for automatic tracking
            <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="Enable this to check the product price automatically at set intervals.">
              <i class="bi bi-info-circle-fill text-info"></i>
            </span>
          </label>
        </div>
        <div class="row schedule-row mb-3" id="schedule_time_row" style="display:none;">
          <div class="col-6">
            <label for="schedule_interval" class="form-label">
              Frequency
              <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="How often (in hours) the product price should be checked automatically.">
                <i class="bi bi-info-circle-fill text-info"></i>
              </span>
            </label>
            <select class="form-select" name="schedule_interval" id="schedule_interval">
              <option value="1">Every 1 hour</option>
              <option value="2">Every 2 hours</option>
              <option value="4" selected>Every 4 hours</option>
              <option value="6">Every 6 hours</option>
              <option value="8">Every 8 hours</option>
              <option value="12">Every 12 hours</option>
              <option value="18">Every 18 hours</option>
              <option value="24">Every 24 hours</option>
            </select>
          </div>
          <div class="col-6">
            <label for="start_time" class="form-label">
              Start time (24h)
              <span tabindex="0" data-bs-toggle="tooltip" data-bs-placement="right" title="The time of day when the first scheduled check should start (in 24-hour format).">
                <i class="bi bi-info-circle-fill text-info"></i>
              </span>
            </label>
            <input type="time" class="form-control" name="start_time" id="start_time" value="00:00">
          </div>
        </div>
        <div class="d-grid">
          <button type="submit" class="btn btn-primary btn-lg">Track Product</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
  // Enable Bootstrap tooltips
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
  function toggleChatIdHelp() {
    const helpDiv = document.getElementById('chatid-help');
    helpDiv.classList.toggle('d-none');
  }
</script>
{% endblock %}
